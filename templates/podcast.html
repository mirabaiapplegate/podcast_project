{% extends 'base.html' %}

{% block head %}
    <link rel="stylesheet" type="text/css" href="/static/css/podcast.css">
    <link rel="stylesheet" type="text/css" href="/static/amplitudejs-master/examples/single-song-live/css/styles.css">
{% endblock%}

{% block body %}

    <!-- Podcast Title and Episode -->
    <div class="col-md-12 col-lg-12 col-xs-12">
      <h4>{{ podcast.show }}: {{ podcast.title }}</h4>
      <p>{{ podcast.description }}</p>
      <!-- Start Carousel -->
      <div id="carousel-image" class="carousel slide" data-ride="carousel">
        <!-- Indicators -->
        <ol class="carousel-indicators"></ol>
        <!-- Wrapper for slides -->
        <div class="carousel-inner">
          <div class="carousel-caption">
            {% if podcast.image_caption %}
              <h3>{{ podcast.image_caption }}</h3>
            {% endif %}
          </div>
        </div>
        <!-- Controls -->
        <a class="left carousel-control" href="#carousel-image" data-slide="prev">
          <span class="glyphicon glyphicon-chevron-left"></span>
        </a>
        <a class="right carousel-control" href="#carousel-image" data-slide="next">
          <span class="glyphicon glyphicon-chevron-right"></span>
        </a>
      </div>

      <div class="input-group input-group-lg">
        
        <img class="img-responsive img-rounded" src="{{ user.profile_image }}" id="comment-profile-image">
        <span class="input-group-btn">
          <button class="btn glyphicon glyphicon-picture" type="button"></button>
        </span>
        <span class="input-group-btn">
          <button class="btn glyphicon glyphicon-link" type="button"></button>
        </span>
        <input type="text" class="form-control" id="comment" placeholder="Write a comment...">
        <span class="input-group-btn">
          <button class="btn btn-primary" id="submit" type="button">Submit</button>
        </span>
      </div><!-- /input-group -->
    </div>
    <!-- End Carousel -->
    {% endblock %}

    {% block footer %}
    <!-- Begin Small Audio Player -->
    <div id="small-player">

      <!-- Begin Small Player Left -->
      <div id="small-player-left">
      </div>
      <!-- End Small Player Left -->

      <!-- Begin Small Player Album Art -->
      <img id="small-player-album-art" amplitude-song-info="cover"/>
      <!-- End Small Player Album Art -->

      <!-- Begin Small Player Middle -->
      <div id="small-player-middle">  
        <div id="small-player-middle-top">

          <!-- Begin Controls Container -->
          <div id="small-player-middle-controls">
            <div class="amplitude-play-pause amplitude-paused" amplitude-main-play-pause="true"></div>
          </div>
          <!-- End Controls Container -->

          <!-- Begin Meta Container -->
          <div id="small-player-middle-meta">
            <div id="now-playing-title" amplitude-song-info="name"></div>
            <div class="album-information" amplitude-song-info="artist"> </div>
            
            <div class="amplitude-song-time-visualization" amplitude-single-song-time-visualization="true" id="song-time-visualization"></div>

          </div>
          <!-- End Meta Container -->
        </div>
      </div>
      <!-- End Small Player Middle -->

      <!-- Begin Small Player Right -->
      <div id="small-player-right">
        <span id="current-time">
          <span class="amplitude-current-minutes" amplitude-single-current-minutes="true">0</span>:<span class="amplitude-current-seconds" amplitude-single-current-seconds="true">00</span>
        </span>
      </div>
      <!-- End Small Player Right -->
    </div>
    <!-- End Small Player -->


    {% endblock %}   

    <!-- Javascript -->
    {% block js %}
      <script src="/static/js/podcast.js"></script>
      <script> 
        "use strict";
        // Wait until page has loaded
        $(document).ready(function() {

        // Get an object of arrays of urls
          $.get('/images/{{ podcast.podcast_id }}.json', function(images) {
            // loop over object to get individual urls
             $.each(images, function(index, value) {
                $.each(value, function(i, url) {
                  $('<div class="item"><img src="'+url+'" class="img-responsive center-block"><div class="carousel-caption"></div></div>').appendTo('.carousel-inner');
                  
                  $('<li data-target="#carousel-image" data-slide-to="'+i+'"></li>').appendTo('.carousel-indicators');
                });

             });
            
            $('.item').first().addClass('active');
            $('.carousel-indicators > li').first().addClass('active');
            $('#carousel-image').carousel();
          });

          // Initialize Amplitude Audio Player
          Amplitude.init({
            "songs": [
                {
                    "name": "{{ podcast.show }}",
                    "artist": "{{ podcast.title }}",
                    "url": "{{ podcast.audio }}",
                    "live": false,
                    "cover_art_url": "{{ podcast.image }}"
                }
            ],
            "default_album_art": "images/no-cover.png"
        });
        
        // Click event handler for comments
        $( "#submit" ).on('click', function(podcast_id, user_id) {
          var comment = $('#comment').val();
          // TODO - this doesn't work because I haven't figured out how to get the user_id onto this page
          // Event(0, None, None, None, comment, podcast_id, user_id)
          // db.session.add(comment);
          // db.session.commit();
        });

        });
      </script>
    {% endblock %}
